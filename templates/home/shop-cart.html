{% extends 'home/base.html' %}{% load static %} {% block css %}
<link rel="stylesheet" href="{% static 'home/css/b_shop-cart.css'%}">
<style>
    .btn-circle.btn-sm {
        width: 30px;
        height: 30px;
        padding: 0px;
        border-radius: 15px;
        font-size: 20px;
        text-align: center;
        font-weight: bold;
    }
</style>

{% endblock %} {% block content %}
<!-- Breadcrumb Begin -->
<div class="breadcrumb-option">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="breadcrumb__links">
                    <a href="{% url 'index' %}"><i class="fa fa-home"></i> Home</a>
                    <span>Shopping cart</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Breadcrumb End -->

<!-- Shop Cart Section Begin -->
<section class="shop-cart spad" id="shop_cart_view">
    <div class="container">
        <div class="row">
            <div class="shopping-cart">

                <div class="column-labels">
                    <label class="product-image1">Image</label>
                    <label class="product-details1">Product</label>
                    <label class="product-price">Price</label>
                    <label class="product-quantity">Quantity</label>
                    <label class="product-line-price">Total</label>
                    <label class="product-removal">Remove</label>

                </div>

                <div id="product_table">
                    <div class="product">
                        <div class="product-image1">
                            <img src="https://s.cdpn.io/3/large-NutroNaturalChoiceAdultLambMealandRiceDryDogFood.png">
                        </div>
                        <div class="product-details1">
                            <div class="product-title"> Rice Dog Food</div>
                            <p class="product-description">our dog's turn!</p>
                        </div>
                        <div class="product-price">45.99</div>
                        <div class="product-quantity">
                            <input type="number" value="1" min="1" max="5">
                        </div>
                        <div class="product-removal">
                            <button class="remove-product">
                          Remove
                        </button>
                        </div>
                        <div class="product-line-price">45.99</div>
                    </div>
                </div>


            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="cart__btn">
                    <a href="#">Continue Shopping</a>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="cart__btn update__btn">
                    <a href="#"><span class="icon_loading"></span> Update cart</a>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                <div class="discount__content">
                    <h6>Discount codes</h6>
                    <form action="#">
                        <input type="text" placeholder="Enter your coupon code">
                        <button type="submit" class="site-btn">Apply</button>
                    </form>
                </div>
            </div>
            <div class="col-lg-4 offset-lg-2">
                <div class="cart__total__procced ">
                    <h6>Cart total</h6>
                    <ul>
                        <li>Subtotal <span id="subtotal"> 750.0</span></li>
                        <li>Total <span id="total"> 750.0</span></li>
                    </ul>
                    <a href="#" class="primary-btn">Proceed to checkout</a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}
<!-- Shop Cart Section End -->
{% block javascript %}
<script>
    check_cart();

    function check_cart() {
        if (Object.keys(cart1).length == 0) {
            document.getElementById('shop_cart_view').innerHTML = "<div class='container text-center' ><div><img src='static/home/undraw_empty_xct9.svg' style='height:300px;width:400px;' class='img-responsive' /></div><h3 style='font-weight:bold;text-align:center;'>Your Cart is Empty</h3><div class='col-lg-6 col-md-6 col-sm-6 ' style='margin:0 auto;' ><div class='cart__btn' ><a href='#' style='border-top:3px solid red;border-bottom:1px solid red;'>Continue Shopping</a></div></div></div>";
        } else {
            create_cart();
            cart1 = JSON.parse(localStorage.getItem('cart1'));
            create_cart_table(cart1);
        }

        function create_cart() {
            if (localStorage.getItem('cart1') == null) {
                cart1 = {};
            } else {
                cart1 = JSON.parse(localStorage.getItem('cart1'));

            }
        }
    }




    $(".product-removal").on('click', 'button.remove-product', function() {
        id = this.id.toString();
        delete cart1[id];
        localStorage.setItem('cart1', JSON.stringify(cart1));
        cart1 = JSON.parse(localStorage.getItem('cart1'));
        document.location.reload(true);
        check_cart();

    });

    function create_cart_table(data) {
        var table = document.getElementById('product_table');
        keys = Object.keys(data);
        leng = Object.keys(data).length;
        var final_price = 0;
        var total_price = 0;

        table.innerHTML = '';
        for (var i = 0; i < leng; i++) {
            id = keys[i]
            total = data[id][3] * data[id][5];
            data[id][6] = total;
            total_price += total;
            var row = "<div class='product'><div class='product-image1'><img src=" + data[id][0] + " /></div><div class='product-details1'><div class='product-title'>" + data[id][1] + "</div><p>" + data[id][2] + "</p></div><div class='product-price'>&#8377; " + data[id][3] + "</div><div class='product-quantity'><button class='btn btn-primary btn-sm btn-circle minus' id='minus" + id + "' >  -  </button><span id='qty" + id + "'> " + data[id][5] + "</span> <button class='btn btn-primary btn-sm btn-circle plus' id='plus" + id + "' >  +  </button></div><div class='product-line-price'><span id='tot" + id + "'>  &#8377; " + data[id][6] + "</span></div><div class='product-removal'><button class='remove-product' id='" + id + "'>Remove</button></div></div>";
            table.innerHTML += row;

        }
        document.getElementById('subtotal').innerHTML = '&#8377; ' + total_price;
        document.getElementById('total').innerHTML = '&#8377; ' + total_price;

        function update_total_price(data) {
            keys = Object.keys(data);
            leng = Object.keys(data).length;
            var total_price = 0;
            for (var i = 0; i < leng; i++) {
                id = keys[i]
                total = data[id][3] * data[id][5];
                total_price += total;
            }
            document.getElementById('subtotal').innerHTML = '&#8377; ' + total_price;
            document.getElementById('total').innerHTML = '&#8377; ' + total_price;


        }

        $('.product-quantity').on('click', 'button.plus', function() {
            id = this.id;
            pk = id.slice(4, );
            cart1[pk][5] += 1;

            if (cart1[pk][5] > 5) {
                cart1[pk][5] = 5;

            }
            total = cart1[pk][3] * cart1[pk][5];
            cart1[pk][6] = total;
            qtyid = 'qty' + pk;
            totid = 'tot' + pk;
            document.getElementById(qtyid).innerHTML = cart1[pk][5];
            document.getElementById(totid).innerHTML = cart1[pk][6];
            localStorage.setItem('cart1', JSON.stringify(cart1));
            update_total_price(cart1);
        });
        $('.product-quantity').on('click', 'button.minus', function() {
            id = this.id.toString();
            pk = id.slice(5, );
            cart1[pk][5] = Math.max(1, cart1[pk][5] - 1);
            total = cart1[pk][3] * cart1[pk][5];
            cart1[pk][6] = total;
            qtyid = 'qty' + pk;
            totid = 'tot' + pk;
            document.getElementById(qtyid).innerHTML = cart1[pk][5];
            document.getElementById(totid).innerHTML = cart1[pk][6];
            localStorage.setItem('cart1', JSON.stringify(cart1));
            update_total_price(cart1);
        });


    }
</script>

{% endblock %}